server:
  port: 48080

--- #################### 数据库相关配置 ####################

spring:
  # 数据源配置项
  datasource:
    druid: # Druid 【监控】相关的全局配置
      web-stat-filter:
        enabled: true
      stat-view-servlet:
        enabled: true
        allow: 127.0.0.1 # 生产环境限制访问IP
        url-pattern: /druid/*
        login-username: ${DRUID_USERNAME}
        login-password: ${DRUID_PASSWORD}
      filter:
        stat:
          enabled: true
          log-slow-sql: true
          slow-sql-millis: 500 # 生产环境调整为500ms
          merge-sql: true
        wall:
          config:
            multi-statement-allow: true
    dynamic:
      druid:
        initial-size: 10
        min-idle: 10
        max-active: 50 # 生产环境增加连接池
        max-wait: 600000
        time-between-eviction-runs-millis: 60000
        min-evictable-idle-time-millis: 300000
        max-evictable-idle-time-millis: 900000
        validation-query: SELECT 1
        test-while-idle: true
        test-on-borrow: false
        test-on-return: false
      primary: master
      datasource:
        master:
          url: ${DB_MASTER_URL}
          username: ${DB_MASTER_USERNAME}
          password: ${DB_MASTER_PASSWORD}
        slave:
          lazy: true
          url: ${DB_SLAVE_URL}
          username: ${DB_SLAVE_USERNAME}
          password: ${DB_SLAVE_PASSWORD}

  # Redis 配置
  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT:6379}
      database: ${REDIS_DATABASE:0}
      password: ${REDIS_PASSWORD}

--- #################### 定时任务相关配置 ####################

spring:
  quartz:
    auto-startup: true
    scheduler-name: schedulerName
    job-store-type: jdbc
    wait-for-jobs-to-complete-on-shutdown: true
    properties:
      org:
        quartz:
          scheduler:
            instanceName: schedulerName
            instanceId: AUTO
          jobStore:
            class: org.springframework.scheduling.quartz.LocalDataSourceJobStore
            isClustered: true
            clusterCheckinInterval: 15000
            misfireThreshold: 60000
          threadPool:
            threadCount: 25
            threadPriority: 5
            class: org.quartz.simpl.SimpleThreadPool
    jdbc:
      initialize-schema: NEVER

--- #################### 消息队列相关 ####################

rocketmq:
  name-server: ${ROCKETMQ_NAMESRV:127.0.0.1:9876}

spring:
  rabbitmq:
    host: ${RABBITMQ_HOST}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME}
    password: ${RABBITMQ_PASSWORD}
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:127.0.0.1:9092}

--- #################### 服务保障相关配置 ####################

lock4j:
  acquire-timeout: 3000
  expire: 30000

--- #################### 监控相关配置 ####################

management:
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized

spring:
  boot:
    admin:
      client:
        url: ${SPRING_BOOT_ADMIN_URL:http://127.0.0.1:${server.port}/${spring.boot.admin.context-path}}
        instance:
          service-host-type: IP
      context-path: /admin

logging:
  file:
    name: /var/log/yshop/${spring.application.name}.log
  level:
    root: WARN
    co.lianxun.yshop: INFO

--- #################### 微信配置 ####################

wx:
  mp:
    app-id: ${WX_MP_APP_ID}
    secret: ${WX_MP_SECRET}
    config-storage:
      type: RedisTemplate
      key-prefix: wx
      http-client-type: HttpClient
  miniapp:
    appid: ${WX_MINIAPP_APPID}
    secret: ${WX_MINIAPP_SECRET}
    config-storage:
      type: RedisTemplate
      key-prefix: wa
      http-client-type: HttpClient

--- #################### yshop相关配置 ####################

yshop:
  xss:
    enable: true # 生产环境启用XSS防护
    exclude-urls:
      - ${spring.boot.admin.context-path}/**
      - ${management.endpoints.web.base-path}/**
  security:
    mock-enable: false # 生产环境必须关闭
  captcha:
    enable: true # 生产环境启用验证码
  demo: false

justauth:
  enabled: true
  type:
    DINGTALK:
      client-id: ${DINGTALK_CLIENT_ID}
      client-secret: ${DINGTALK_CLIENT_SECRET}
      ignore-check-redirect-uri: true
    WECHAT_ENTERPRISE:
      client-id: ${WECHAT_ENTERPRISE_CLIENT_ID}
      client-secret: ${WECHAT_ENTERPRISE_CLIENT_SECRET}
      agent-id: ${WECHAT_ENTERPRISE_AGENT_ID}
      ignore-check-redirect-uri: true
    WECHAT_MINI_APP:
      client-id: ${wx.miniapp.appid}
      client-secret: ${wx.miniapp.secret}
      ignore-check-redirect-uri: true
      ignore-check-state: true
    WECHAT_MP:
      client-id: ${wx.mp.app-id}
      client-secret: ${wx.mp.secret}
      ignore-check-redirect-uri: true
  cache:
    type: REDIS
    prefix: 'social_auth_state:'
    timeout: 24h
